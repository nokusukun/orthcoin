
<!DOCTYPE html>
<html>
<head>
	<!-- Standard Meta -->
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

	<!-- Site Properties -->
	<title>Map</title>
	<script defer src="/static/fontawesome_all.js"></script>
	<!-- Compiled and minified JavaScript -->
	<script src="/static/angular.min.js"></script>
	<script src="/static/jquery-3.2.1.min.js"></script>

	<link rel="stylesheet" href="/static/semantic.min.css"/>
	<script src="/static/semantic.min.js"></script>
	<script type="text/javascript" src="/static/toastr.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/toastr.min.css">
</head>
<body ng-app="dashboard" ng-controller='ctrlDashboard'>
	<div class="ui container">
		<br>
		<div class="ui secondary menu">
			<div class="header item">Dashboard</div>
			<a class="active item" href="/dashboard">
				My Account
			</a>
			<a class="item" href="/dashboard/places">
				Places
			</a>
			<a class="item">
				Settings
			</a>
			<a  href="/dashboard/places/new" class="blue item"><i class="beer icon"></i>Add a Place</a>
			<div class="right menu">
				<div class="item">
					<div class="ui icon input">
						<input type="text" placeholder="Search...">
						<i class="search link icon"></i>
					</div>
				</div>
				<a class="ui item" ng-click="logout()">
					Logout
				</a>
			</div>
		</div>
		<div class="ui divider"></div>
		<br>
		<div class="ui grid">
			<div class="four wide column">
				<div class="ui secondary vertical pointing fluid menu">
					<a class="item active">
						Details
					</a>
					<a class="item">
						Places
					</a>
				</div>
			</div>
			<div class="twelve wide column">
				<form class="ui form">
					<h4 class="ui horizontal divider header">
						<i class="user circle icon"></i>
						My Details
					</h4>
					<div class="two fields">
						<div class="field">
							<label>First Name</label>
							<input type="text" ng-model="details.firstname" name="first-name" placeholder="First Name">
						</div>
						<div class="field">
							<label>Last Name</label>
							<input type="text" ng-model="details.lastname" name="last-name" placeholder="Last Name">
						</div>
					</div>
					<div class="three fields">
						<div class="field">
							<label>Gender</label>
							<input type="text" ng-model="details.sex" name="sex" placeholder="Gender">
						</div>
						<div class="field">
							<label>Age</label>
							<input type="text" ng-model="details.age" name="age" placeholder="Age">
						</div>
						<div class="field">
							<label>Date of Birth</label>
							<input type="text" ng-model="details.date_of_birth" name="date_of_birth" placeholder="Date of Birth">
						</div>
					</div>
					<div class="two fields">
						<div class="field">
							<label>Contact Number</label>
							<input type="text" ng-model="details.contact_number" name="contact_number" placeholder="Contact Number">
						</div>
						<div class="field">
							<label>Nationality</label>
							<input type="text" ng-model="details.nationality" name="nationality" placeholder="Nationality">
						</div>
					</div>
					<div class="field">
						<label>Business</label>
						<input type="text" ng-model="details.business" name="business" placeholder="Business">
					</div>
					<div class="field">
						<label>Email</label>
						<input type="text" ng-model="details.email" name="email" placeholder="Email">
					</div>
					<h4 class="ui horizontal divider header">
						<i class="id card outline icon"></i>
						Account
					</h4>
					<div class="field">
						<label>Username</label>
						<input type="text" ng-model="details.username" name="username" placeholder="Username">
					</div>
					<div class="field">
						<label>Password</label>
						<input type="password" ng-model="details.password" name="password" placeholder="Password">
					</div>
					<div class="ui fluid blue submit button" ng-click="save()">Save</div>
				</form>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		var app = angular.module('dashboard', []);
		app.controller('ctrlDashboard', function($scope, $http, $timeout, $window) {
			console.log('Requesting Token');
			request = {
				method: 'POST',
				url: '/api/account/details',
				headers: {'Content-Type': 'application/json'},
				data: {'token': localStorage.token},
			}
			$http(request).then(function(response){
				console.log(response.data);
				if(response.data.success){
					toastr["success"]("Loaded Data!", "Debug")
					if(response.data.result.admin){
						window.location.href = '/dashboard/admin';
					}
					$scope.details = response.data.result;
				}else{
					$scope.error = response.data.result;
					toastr["error"]($scope.error, "Error")
				}
			}, function(){
				$scope.error = "An unknown error occured!";
			});

			$scope.save = function(){
				$scope.details.token = localStorage.token;
				request = {
					method: 'POST',
					url: '/api/account/update',
					headers: {'Content-Type': 'application/json'},
					data: $scope.details
				}
				$http(request).then(function(response){
					console.log(response.data);
					if(response.data.success){
						$scope.details = response.data.result;
						toastr["success"]("Success", "Saved!")
					}else{
						$scope.error = response.data.result;
						toastr["error"]($scope.error, "Error")
						window.location.href = '/login';
					}
				}, function(){
					$scope.error = response.data.result;
					toastr["error"]($scope.error, "Error")
				});

			}
			$scope.logout = function(){
				localStorage.token = "";
				window.location.href = '/login';
			}
		});


	</script>
</body>

</html>
