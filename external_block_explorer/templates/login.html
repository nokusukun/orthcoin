
<!DOCTYPE html>
<html>
<head>
	<!-- Standard Meta -->
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

	<!-- Site Properties -->
	<title>Login</title>
	<script defer src="/static/fontawesome_all.js"></script>
	<!-- Compiled and minified JavaScript -->
	<script src="/static/angular.min.js"></script>
	<script src="/static/jquery-3.2.1.min.js"></script>

	<link rel="stylesheet" href="/static/semantic.min.css"/>
	<script src="/static/semantic.min.js"></script>
	<script type="text/javascript" src="/static/toastr.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/toastr.min.css">
	<style type="text/css">
	body {
		background-color: #DADADA;
	}
	body > .grid {
		height: 100%;
	}
	.image {
		margin-top: -100px;
	}
	.column {
		max-width: 450px;
	}
</style>
<script>
	$(document)
	.ready(function() {
		$('.ui.form')
		.form();
	})
	;
</script>
</head>
<body ng-app="login" ng-controller='ctrlLogin'>
	<div class="ui modal success	">
		<div class="header">Logged in!</div>
		<div class="content">
			<p>Welcome {{username}}! Redirecting to your dashboard...</p>
		</div>
		<div class="actions">
			<div class="ui button">Continue</div>
		</div>
	</div>
	<div class="ui middle aligned center aligned grid">
		<div class="column">
			<h2 class="ui blue image header">
				<div class="content">
					Log-in to your account
				</div>
			</h2>
			<div class="ui large form">
				<div class="ui stacked segment">
					<div class="field">
						<div class="ui left icon input">
							<i class="user icon"></i>
							<input type="text" name="username" placeholder="Username" ng-model="username">
						</div>
					</div>
					<div class="field">
						<div class="ui left icon input">
							<i class="lock icon"></i>
							<input type="password" name="password" ng-model="password" placeholder="Password">
						</div>
					</div>
					<div class="ui fluid blue submit button" ng-click="login()">Login</div>
				</div>

				<div class="ui negative message" ng-class="{visible: error}" ng-show="error" ng-cloak>
					<div class="header">
						Something went wrong!
					</div>
					<p>{{error}}
					</p></div>

				</div>

				<div class="ui message">
					New to us? <a href="#" ng-click="openRegister()">Sign Up</a>
				</div>
			</div>
		</div>

		<div class="ui modal register">
			<i class="close icon"></i>
			<div class="header"> Register</div>
			<div class="content">
				<form class="ui form">
					<div class="two fields">
						<div class="field">
							<label>First Name</label>
							<input type="text" ng-model="regFirstName" name="first-name" placeholder="First Name">
						</div>
						<div class="field">
							<label>Last Name</label>
							<input type="text" ng-model="regLastName" name="last-name" placeholder="Last Name">
						</div>
					</div>
					<div class="field">
						<label>Email</label>
						<input type="text" ng-model="regEmail" name="email" placeholder="Email">
					</div>
					<div class="field">
						<label>Username</label>
						<input type="text" ng-model="regUsername" name="username" placeholder="Username">
					</div>
					<div class="field">
						<label>Password</label>
						<input type="password" ng-model="regPassword" name="password" placeholder="Password">
					</div>
					<div class="field">
						<div class="ui checkbox">
							<input type="checkbox" tabindex="0" class="hidden">
							<label>I agree to the Terms and Conditions</label>
						</div>
					</div>
					<div class="ui fluid blue submit button" ng-click="register()">Submit</div>
				</form>
			</div>	
		</div>

		<script type="text/javascript">
			$('.ui.modal').modal();
			$('.ui.checkbox').checkbox();
			var app = angular.module('login', []);
			app.controller('ctrlLogin', function($scope, $http, $window) {

				$scope.openRegister = function (){
					console.log("Opened");
					$('ui.modal.register').modal();
					$('.ui.modal.register').modal('show');
				}

				$scope.register = function (){
					request = {
						method: 'POST',
						url: '/api/account/new',
						headers: {'Content-Type': 'application/json'},
						data: {
							'firstname': $scope.regFirstName,
							'lastname': $scope.regLastName,
							'email': $scope.regEmail,
							'username': $scope.regUsername,
							'password': $scope.regPassword},
						}
						console.log(request.data);
						$http(request).then(function(response){
							console.log(response.data);
							if(response.data.success){
								console.log("Logged in.");
								$('.ui.modal.success').modal('show');
								$scope.username = response.data.result.username;
								localStorage.token = response.data.result.token;
							}else{
								$scope.error = response.data.result;
							}
						}, function(){
							$scope.error = "An unknown error occured!";
						});
				}

				$scope.login = function(){
					console.log('Requesting Token');
					request = {
						method: 'POST',
						url: '/api/account/login',
						headers: {'Content-Type': 'application/json'},
						data: {'username': $scope.username,
						'password': $scope.password},
					}
					$http(request).then(function(response){
						console.log(response.data);
						if(response.data.success){
							console.log("Logged in.");
							$scope.username = response.data.result.username;
							localStorage.token = response.data.result.token;
							$window.location.href = 'dashboard';
						}else{
							$scope.error = response.data.result;
						}
					}, function(){
						$scope.error = "An unknown error occured!";
					});
				}
			});
		</script>
	</body>

	</html>
