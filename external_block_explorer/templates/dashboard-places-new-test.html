
<!DOCTYPE html>
<html>
<head>
	<!-- Standard Meta -->
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

	<!-- Site Properties -->
	<title>Map</title>
	<script defer src="/static/fontawesome_all.js"></script>
	<!-- Compiled and minified JavaScript -->
	<script src="/static/angular.min.js"></script>
	<script src="/static/jquery-3.2.1.min.js"></script>

	<link rel="stylesheet" href="/static/semantic.min.css"/>
	<script src="/static/semantic.min.js"></script>
	<script type="text/javascript" src="/static/toastr.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/toastr.min.css">

	<script src='/static/mapbox-gl.js'></script>
	<link href='/static/mapbox-gl.css' rel='stylesheet' />
	<script src='https://unpkg.com/mapbox@1.0.0-beta10/dist/mapbox-sdk.min.js'></script>

</head>
<body ng-app="dashboard" ng-controller='ctrlDashboard'>
	<div class="ui container">
		<div class="ui message">
			<div class="header">
				<h4>Details</h4>
			</div>
			<h5>Phone Number</h5>
			<div class="ui right labeled input">
				<label for="amount" class="ui label">+63</label>
				<input placeholder="926..." type="number">
			</div>
		</div>

		<div class="ui message" ng-repeat="(menuindex, m) in menu">
			<div class="header"> 
				<h4>Menu Name</h4>
				<div class="ui fluid input">
					<input type="text" placeholder="Menu Name" ng-model="m.name" ng-change="reloadDropdown()">
				</div>
			</div><br>
			<h5>Menu Items</h5>
			<div style="margin: .5rem; padding-left: .5rem; border-left: solid; border-left-color: gray;overflow-x: overlay;max-height: 50vh;">
				<div ng-repeat="item in m.items">
					<div class="ui form" style="margin-bottom: .5rem;">
						<div class="inline fields">
							<div class="ten wide field">
								<label>Item Name</label>
								<input type="text" placeholder="Item Name" ng-model="item.name" ng-change="reloadDropdown()" ng-change="calculateAverage()">
							</div>
							<div class="six wide field">
								<div class="ui right labeled input">
									<label for="amount" class="ui label">PHP</label>
									<input type="text" placeholder="Amount" id="amount" ng-model="item.price" ng-change="calculateAverage()">
									<div class="ui basic label">.00</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<button class="ui primary button" ng-click="newItem(m.name)">
				Add New
			</button>
			<button class="ui secondary button" ng-click="removeItem(m.name)">
				Remove Item
			</button>
			<button class="ui red button" ng-click="removeMenu(menuindex)" style="float: right;">
				Remove Menu
			</button>
		</div>
		<div class="ui message">
			<div class="header">
				<h5>New Menu</h5>
				<div class="ui right labeled left icon input">
					<i class="tags icon"></i>
					<input type="text" placeholder="Menu Name" ng-model='newmenu'>
					<a class="ui tag label" ng-click='newMenu()'>
						Add
					</a>
				</div>
			</div>
		</div>
		<div class="ui message">
			<div class="header" style="margin-bottom: 1rem;">
				Specialty
			</div>
			<h4>Menu</h4>
			<div id="specialty-selector" class="ui fluid selection dropdown">
				<input type="hidden" name="menu" ng-model="specialtySelected" ng-change="specialtyChange()">
				<i class="dropdown icon"></i>
				<div class="default text">Menu</div>
				<div class="menu" ng-repeat="(index, m) in menu">
					<div class="item" data-value="{{index}}">{{m.name}}</div>
				</div>
			</div>
			<h4>Item</h4>
			<div id="specialty-selector-item" class="ui fluid selection dropdown">
				<input type="hidden" name="menu" ng-model="specialtySelectedItem">
				<i class="dropdown icon"></i>
				<div class="default text">Item</div>
				<div class="menu">
				</div>
			</div>
		</div>
		<div class="ui message">
			<h3>Average Budget: {{budgetMin}} to {{budgetMax}} php</h3>
		</div>

	</div>

	<script src="/static/style-osm.js"></script>

	<script type="text/javascript">
		$('.ui.rating').rating();
		var app = angular.module('dashboard', []);
		app.controller('ctrlDashboard', function($scope, $http, $timeout, $window) {
			$scope.menu = [
				{
					name: 'New Menu',
					items: [{name: 'Champorado', price: 100}]
				}
			];
			$scope.averageBudget = 100;
			$('#specialty-selector-item').dropdown();
			$('#specialty-selector').dropdown({'onChange': function (value, text, choice){
					console.log(value, text, choice);
					console.log($scope.menu[value]);
					values = [];
					for(i = 0; i < $scope.menu[value].items.length; i++){
						values.push({
							value: $scope.menu[value].items[i].name,
							text: $scope.menu[value].items[i].name,
							name: $scope.menu[value].items[i].name
						});
					}
					console.log(values);
					$('#specialty-selector-item').dropdown('setup menu', {values: values});
				}});

			$scope.newItem = function(menu){
				function search(nameKey, myArray){
				for (var i=0; i < myArray.length; i++) {
					if (myArray[i].name === nameKey) {
						return myArray[i];
						}
					}
				}
				search(menu, $scope.menu).items.push({name: '', price: 0});
				console.log($scope.menu);
				$scope.reloadDropdown();
			}

			$scope.removeItem = function(menu){
				function search(nameKey, myArray){
				for (var i=0; i < myArray.length; i++) {
					if (myArray[i].name === nameKey) {
						return myArray[i];
						}
					}
				}
				search(menu, $scope.menu).items.pop()
			}

			$scope.removeMenu = function(index){
				$scope.menu.pop(index);
			}

			$scope.newMenu = function() {
				$scope.menu.push({
					name: $scope.newmenu,
					items: [{name: '', price: 0}]
				});
				$scope.reloadDropdown();
			}

			$scope.reloadDropdown = function () {
				values = [];
				for(i = 0; i < $scope.menu.length; i++){
					values.push({
						value: i,
						text: $scope.menu[i].name,
						name: $scope.menu[i].name
					});
				}
				$('#specialty-selector').dropdown('setup menu', {values: values});
				$scope.calculateAverage();
			}

			$scope.calculateAverage = function () {
				$scope.budgetMin = 1000000000;
				$scope.budgetMax = 0;
				
				$scope.menu.forEach(element => {
					element.items.forEach(item => {
						if(Number(item.price) > $scope.budgetMax){
							$scope.budgetMax = item.price;
						}
						if(Number(item.price) < $scope.budgetMin){
							$scope.budgetMin = item.price;
						}
					})
				});
				//console.log(total, count);
				//$scope.averageBudget = Number(total / count).toFixed();
				
			}

		});
	</script>
	<script type="text/javascript">

	</script>
</body>

</html>
